<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlashMorCoin - Protocolo DeFi</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white; font-family: 'Arial', sans-serif;
            min-height: 100vh;
        }
        
        /* ========== LOGO MONEDA ANTIGUA ========== */
        .ancient-coin {
            width: 60px;
            height: 60px;
            background: radial-gradient(circle at 30% 30%, #D4AF37, #B8860B, #8B4513);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 0 0 2px #8B4513,
                0 4px 15px rgba(139, 69, 19, 0.6),
                inset 0 1px 6px rgba(255, 215, 0, 0.4);
            border: 2px solid #CD7F32;
            position: relative;
            font-family: 'Times New Roman', serif;
        }

        .ancient-coin::before {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle at 70% 70%, transparent 30%, rgba(0,0,0,0.2) 100%);
        }

        .coin-design {
            position: relative;
            z-index: 2;
            text-align: center;
            color: #8B4513;
            text-shadow: 1px 1px 2px rgba(255, 215, 0, 0.5);
        }

        .coin-symbol {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 1px;
        }

        .coin-text {
            font-size: 9px;
            font-weight: bold;
            letter-spacing: 0.5px;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        /* Header */
        header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px 30px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .brand-text {
            font-size: 1.8rem;
            font-weight: bold;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* Botones */
        .connect-btn {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .connect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .connect-btn.connected {
            background: linear-gradient(45deg, #4CAF50, #45a049);
        }
        
        /* Cards */
        .card { 
            background: rgba(255,255,255,0.1); 
            backdrop-filter: blur(10px);
            padding: 25px; 
            border-radius: 15px; 
            margin: 20px 0; 
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .action-btn { 
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #8B4513; 
            border: none; 
            padding: 12px 20px; 
            border-radius: 8px; 
            cursor: pointer; 
            margin: 5px; 
            font-weight: bold; 
            transition: all 0.3s;
            width: 100%;
        }
        
        .action-btn:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        
        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px; 
        }
        
        input, select { 
            width: 100%; 
            padding: 12px; 
            margin: 8px 0; 
            border: none; 
            border-radius: 8px; 
            background: rgba(255,255,255,0.9);
            color: #333;
        }
        
        /* Loading */
        .loading { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.8); 
            z-index: 1000; 
            justify-content: center; 
            align-items: center; 
        }
        
        .success { 
            background: rgba(76, 175, 80, 0.3); 
            border: 1px solid #4CAF50; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 10px 0; 
        }
        
        .error { 
            background: rgba(244, 67, 54, 0.3); 
            border: 1px solid #f44336; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 10px 0; 
        }
        
        .wallet-info {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.3);
            text-align: center;
        }
        
        .status-badge { 
            padding: 4px 8px; 
            border-radius: 12px; 
            font-size: 12px; 
            margin-left: 10px; 
        }
        
        .status-active { 
            background: #4CAF50; 
        }
        
        .status-inactive { 
            background: #f44336; 
        }
        
        .trade-item { 
            background: rgba(255,255,255,0.05); 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 8px; 
            border: 1px solid rgba(255,255,255,0.1);
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div style="background: white; color: #333; padding: 30px; border-radius: 15px; text-align: center; min-width: 300px;">
            <div style="font-size: 2rem; margin-bottom: 10px;">‚è≥</div>
            <p id="loading-text">Conectando con MetaMask...</p>
        </div>
    </div>

    <div class="container">
        <!-- Header con Logo -->
        <header>
            <div class="logo-container">
                <div class="ancient-coin">
                    <div class="coin-design">
                        <div class="coin-symbol">‚ö°</div>
                        <div class="coin-text">FMC</div>
                    </div>
                </div>
                <div class="brand-text">FlashMorCoin</div>
            </div>
            
            <div id="wallet-section">
                <button class="connect-btn" onclick="connectWallet()" id="connect-btn">
                    üîó Conectar MetaMask
                </button>
                <div class="wallet-info" id="wallet-info" style="display: none;">
                    <div><strong>‚úÖ Conectado:</strong> <span id="wallet-address"></span></div>
                    <div><strong>üí∞ Balance:</strong> <span id="wallet-balance">-</span> MATIC</div>
                    <button onclick="disconnectWallet()" style="background: #ff4444; color: white; padding: 5px 10px; margin-top: 8px; font-size: 12px;">
                        üö™ Desconectar
                    </button>
                </div>
            </div>
        </header>

        <!-- Mensaje de Bienvenida -->
        <div class="card" id="welcome-section">
            <h2>üöÄ Bienvenido a FlashMorCoin</h2>
            <p>Protocolo DeFi para liquidez instant√°nea en Yield Farming</p>
            <div class="grid" style="margin-top: 20px;">
                <div>
                    <h3>üìä Para comenzar:</h3>
                    <p>1. üëÜ Haz clic en "Conectar MetaMask"</p>
                    <p>2. ‚úÖ Acepta la conexi√≥n en tu wallet</p>
                    <p>3. üåê Cambia a la red Polygon Mumbai</p>
                    <p>4. üéâ ¬°Listo para usar FlashMorCoin!</p>
                </div>
                <div>
                    <h3>üí° ¬øProblemas de conexi√≥n?</h3>
                    <p>‚Ä¢ üîç Aseg√∫rate de tener MetaMask instalado</p>
                    <p>‚Ä¢ ‚úÖ Acepta la solicitud de conexi√≥n</p>
                    <p>‚Ä¢ üåê Usa la red Mumbai Testnet</p>
                    <button onclick="installMetaMask()" style="background: #FF6B6B; color: white; padding: 10px 15px;">
                        üì≤ Instalar MetaMask
                    </button>
                </div>
            </div>
        </div>

        <!-- Secci√≥n de Contratos (visible cuando est√© conectado) -->
        <div class="card" id="contracts-section" style="display: none;">
            <h2>‚öôÔ∏è Configuraci√≥n de Contratos</h2>
            <div class="grid">
                <div>
                    <h3>üîó Contrato FMC</h3>
                    <p>Estado: <span id="fmc-status" class="status-badge status-inactive">No configurado</span></p>
                    <input type="text" id="fmc-address" 
                           placeholder="0xfb146E2601c5F77743E4888E75D6577C2F56bAbb" 
                           value="0xfb146E2601c5F77743E4888E75D6577C2F56bAbb"
                           style="font-family: monospace;">
                    <button class="action-btn" onclick="configureFMC()">‚úÖ Configurar FMC</button>
                </div>
                <div>
                    <h3>üè¶ Contrato Vault</h3>
                    <p>Estado: <span id="vault-status" class="status-badge status-inactive">No configurado</span></p>
                    <input type="text" id="vault-address" 
                           placeholder="0x0371b4dcB192905C9010B2699a061D186AAFf205" 
                           value="0x0371b4dcB192905C9010B2699a061D186AAFf205"
                           style="font-family: monospace;">
                    <button class="action-btn" onclick="configureVault()">‚úÖ Configurar Vault</button>
                </div>
            </div>
        </div>

        <!-- Portfolio (visible cuando est√© conectado) -->
        <div class="card" id="portfolio-section" style="display: none;">
            <h2>üìä Tu Portfolio en Vivo</h2>
            <div class="grid">
                <div>
                    <p>üëõ <strong>Wallet:</strong> <span id="display-address">-</span></p>
                    <p>üí∞ <strong>Balance MATIC:</strong> <span id="matic-balance">-</span></p>
                </div>
                <div>
                    <p>ü™ô <strong>Balance FMC:</strong> <span id="fmc-balance">0.00 FMC</span></p>
                    <p>üè¶ <strong>Colateral:</strong> <span id="vault-balance">0.00 USDC</span></p>
                </div>
            </div>
        </div>

        <!-- Acciones Principales (visible cuando est√© conectado) -->
        <div class="grid" id="actions-section" style="display: none;">
            <!-- Depositar -->
            <div class="card">
                <h3>üè¶ Depositar Colateral</h3>
                <select id="deposit-token">
                    <option value="usdc">USDC</option>
                    <option value="dai">DAI</option>
                    <option value="wmatic">WMATIC</option>
                </select>
                <input type="number" placeholder="Cantidad a depositar" id="deposit-amount" step="0.001">
                <button class="action-btn" onclick="depositAction()">‚úÖ Depositar Colateral</button>
            </div>

            <!-- Mintear -->
            <div class="card">
                <h3>ü™ô Mintear FMC</h3>
                <p style="font-size: 0.9em; opacity: 0.8; margin: 10px 0;">
                    Genera tokens FMC usando tu colateral como garant√≠a
                </p>
                <input type="number" placeholder="Cantidad FMC a mintear" id="mint-amount" step="0.001">
                <button class="action-btn" onclick="mintAction()">ü™ô Mintear FMC</button>
            </div>

            <!-- Transferir -->
            <div class="card">
                <h3>üì§ Transferir FMC</h3>
                <input type="text" placeholder="Direcci√≥n destino (0x...)" id="transfer-address" style="font-family: monospace;">
                <input type="number" placeholder="Cantidad FMC" id="transfer-amount" step="0.001">
                <button class="action-btn" onclick="transferAction()">üì§ Transferir FMC</button>
            </div>
        </div>

        <!-- Mercado P2P (visible cuando est√© conectado) -->
        <div class="card" id="p2p-section" style="display: none;">
            <h2>üîÑ Mercado P2P FlashMorCoin</h2>
            <div class="grid">
                <div>
                    <h3>üõí Comprar FMC</h3>
                    <input type="number" placeholder="Cantidad FMC a comprar" id="buy-amount" step="0.001">
                    <p style="margin: 10px 0;">Precio estimado: <span id="buy-price">1.02</span> USDC por FMC</p>
                    <button class="action-btn" onclick="buyFMC()">‚úÖ Comprar FMC</button>
                </div>
                <div>
                    <h3>üí∞ Vender FMC</h3>
                    <input type="number" placeholder="Cantidad FMC a vender" id="sell-amount" step="0.001">
                    <input type="number" placeholder="Precio en USDC" id="sell-price" step="0.0001" value="1.02">
                    <button class="action-btn" onclick="sellFMC()">üí∞ Vender FMC</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== ESTADO GLOBAL ====================
        let web3 = null;
        let userAddress = null;
        let userBalance = '0';

        // ==================== CONEXI√ìN METAMASK ====================
        async function connectWallet() {
            console.log('üîó Iniciando conexi√≥n con MetaMask...');
            
            if (typeof window.ethereum === 'undefined') {
                showError('‚ùå MetaMask no detectado. Por favor instala MetaMask.');
                return;
            }

            try {
                showLoading('Conectando con MetaMask...');
                
                // Solicitar acceso a las cuentas
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });
                
                console.log('‚úÖ Cuentas obtenidas:', accounts);
                
                if (accounts.length === 0) {
                    throw new Error('Usuario rechaz√≥ la conexi√≥n');
                }
                
                userAddress = accounts[0];
                
                // Inicializar Web3
                web3 = new Web3(window.ethereum);
                
                // Obtener balance
                await updateBalance();
                
                // Actualizar interfaz
                updateUI();
                
                // Configurar listeners de eventos
                setupEventListeners();
                
                hideLoading();
                showSuccess('üéâ ¬°Wallet conectada exitosamente!');
                
            } catch (error) {
                hideLoading();
                console.error('‚ùå Error en conexi√≥n:', error);
                
                if (error.code === 4001) {
                    showError('‚ùå Rechazaste la conexi√≥n. Haz clic en "Conectar" en la ventana de MetaMask.');
                } else if (error.code === -32002) {
                    showError('‚è≥ Ya hay una solicitud pendiente. Revisa MetaMask.');
                } else {
                    showError('Error de conexi√≥n: ' + error.message);
                }
            }
        }

        async function updateBalance() {
            if (!web3 || !userAddress) return;
            
            try {
                const balance = await web3.eth.getBalance(userAddress);
                userBalance = parseFloat(web3.utils.fromWei(balance, 'ether')).toFixed(4);
                console.log('üí∞ Balance actualizado:', userBalance);
            } catch (error) {
                console.error('Error obteniendo balance:', error);
                userBalance = 'Error';
            }
        }

        function updateUI() {
            // Actualizar informaci√≥n de wallet
            const shortAddress = `${userAddress.slice(0, 6)}...${userAddress.slice(-4)}`;
            document.getElementById('wallet-address').textContent = shortAddress;
            document.getElementById('wallet-balance').textContent = userBalance;
            document.getElementById('display-address').textContent = shortAddress;
            document.getElementById('matic-balance').textContent = userBalance + ' MATIC';
            
            // Mostrar secciones principales
            document.getElementById('wallet-info').style.display = 'block';
            document.getElementById('connect-btn').style.display = 'none';
            document.getElementById('welcome-section').style.display = 'none';
            document.getElementById('contracts-section').style.display = 'block';
            document.getElementById('portfolio-section').style.display = 'block';
            document.getElementById('actions-section').style.display = 'grid';
            document.getElementById('p2p-section').style.display = 'block';
        }

        function setupEventListeners() {
            // Cambios de cuenta
            window.ethereum.on('accountsChanged', (accounts) => {
                console.log('üîÑ Cuenta cambiada:', accounts);
                if (accounts.length === 0) {
                    disconnectWallet();
                } else {
                    userAddress = accounts[0];
                    updateBalance().then(updateUI);
                    showSuccess('üîÑ Cuenta actualizada');
                }
            });
            
            // Cambios de red
            window.ethereum.on('chainChanged', (chainId) => {
                console.log('üåê Red cambiada:', chainId);
                showSuccess('üåê Red actualizada - Recargando...');
                setTimeout(() => location.reload(), 1000);
            });
        }

        function disconnectWallet() {
            userAddress = null;
            web3 = null;
            document.getElementById('connect-btn').style.display = 'block';
            document.getElementById('wallet-info').style.display = 'none';
            document.getElementById('welcome-section').style.display = 'block';
            document.getElementById('contracts-section').style.display = 'none';
            document.getElementById('portfolio-section').style.display = 'none';
            document.getElementById('actions-section').style.display = 'none';
            document.getElementById('p2p-section').style.display = 'none';
            showSuccess('üëã Wallet desconectada');
        }

        // ==================== FUNCIONES DE CONTRATOS ====================
        function configureFMC() {
            const address = document.getElementById('fmc-address').value;
            if (isValidAddress(address)) {
                document.getElementById('fmc-status').textContent = 'Configurado ‚úÖ';
                document.getElementById('fmc-status').className = 'status-badge status-active';
                showSuccess('‚úÖ Contrato FMC configurado correctamente');
            } else {
                showError('‚ùå Direcci√≥n de contrato FMC inv√°lida');
            }
        }

        function configureVault() {
            const address = document.getElementById('vault-address').value;
            if (isValidAddress(address)) {
                document.getElementById('vault-status').textContent = 'Configurado ‚úÖ';
                document.getElementById('vault-status').className = 'status-badge status-active';
                showSuccess('‚úÖ Contrato Vault configurado correctamente');
            } else {
                showError('‚ùå Direcci√≥n de contrato Vault inv√°lida');
            }
        }

        // ==================== FUNCIONES DE ACCI√ìN ====================
        async function depositAction() {
            const amount = document.getElementById('deposit-amount').value;
            const token = document.getElementById('deposit-token').value;
            
            if (!amount || amount <= 0) {
                showError('‚ùå Ingresa una cantidad v√°lida');
                return;
            }

            showLoading(`üè¶ Depositando ${amount} ${token.toUpperCase()}...`);
            setTimeout(() => {
                hideLoading();
                showSuccess(`‚úÖ ${amount} ${token.toUpperCase()} depositado exitosamente`);
                document.getElementById('deposit-amount').value = '';
            }, 2000);
        }

        async function mintAction() {
            const amount = document.getElementById('mint-amount').value;
            
            if (!amount || amount <= 0) {
                showError('‚ùå Ingresa una cantidad v√°lida de FMC');
                return;
            }

            showLoading(`ü™ô Minteando ${amount} FMC...`);
            setTimeout(() => {
                hideLoading();
                showSuccess(`‚úÖ ${amount} FMC minteados exitosamente`);
                document.getElementById('mint-amount').value = '';
            }, 2000);
        }

        async function transferAction() {
            const toAddress = document.getElementById('transfer-address').value;
            const amount = document.getElementById('transfer-amount').value;
            
            if (!isValidAddress(toAddress)) {
                showError('‚ùå Direcci√≥n destino inv√°lida');
                return;
            }

            if (!amount || amount <= 0) {
                showError('‚ùå Ingresa una cantidad v√°lida');
                return;
            }

            showLoading(`üì§ Enviando ${amount} FMC...`);
            setTimeout(() => {
                hideLoading();
                showSuccess(`‚úÖ ${amount} FMC enviados a ${toAddress.slice(0,8)}...`);
                document.getElementById('transfer-address').value = '';
                document.getElementById('transfer-amount').value = '';
            }, 2000);
        }

        async function buyFMC() {
            const amount = document.getElementById('buy-amount').value;
            if (!amount) {
                showError('‚ùå Ingresa cantidad a comprar');
                return;
            }
            
            showLoading(`üõí Comprando ${amount} FMC...`);
            setTimeout(() => {
                hideLoading();
                showSuccess(`‚úÖ Compra de ${amount} FMC ejecutada exitosamente`);
                document.getElementById('buy-amount').value = '';
            }, 2000);
        }

        async function sellFMC() {
            const amount = document.getElementById('sell-amount').value;
            const price = document.getElementById('sell-price').value;
            
            if (!amount || !price) {
                showError('‚ùå Completa cantidad y precio');
                return;
            }
            
            showLoading(`üí∞ Vendiendo ${amount} FMC...`);
            setTimeout(() => {
                hideLoading();
                showSuccess(`‚úÖ Venta de ${amount} FMC creada a ${price} USDC`);
                document.getElementById('sell-amount').value = '';
            }, 2000);
        }

        // ==================== FUNCIONES UTILITARIAS ====================
        function isValidAddress(address) {
            return /^0x[a-fA-F0-9]{40}$/.test(address);
        }

        function installMetaMask() {
            window.open('https://metamask.io/download.html', '_blank');
        }

        function showLoading(message) {
            document.getElementById('loading').style.display = 'flex';
            document.getElementById('loading-text').textContent = message;
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function showSuccess(message) {
            const div = document.createElement('div');
            div.className = 'success';
            div.innerHTML = message;
            document.querySelector('.container').prepend(div);
            setTimeout(() => div.remove(), 5000);
        }

        function showError(message) {
            const div = document.createElement('div');
            div.className = 'error';
            div.innerHTML = message;
            document.querySelector('.container').prepend(div);
            setTimeout(() => div.remove(), 5000);
        }

        // ==================== INICIALIZACI√ìN ====================
        window.addEventListener('load', function() {
            console.log('üöÄ FlashMorCoin inicializado');
            
            // Verificar si ya hay una wallet conectada
            if (typeof window.ethereum !== 'undefined') {
                window.ethereum.request({ method: 'eth_accounts' })
                    .then(accounts => {
                        if (accounts.length > 0) {
                            userAddress = accounts[0];
                            web3 = new Web3(window.ethereum);
                            updateBalance().then(updateUI);
                            setupEventListeners();
                            console.log('‚úÖ Wallet ya conectada:', userAddress);
                        }
                    })
                    .catch(error => {
                        console.log('‚ÑπÔ∏è No hay wallet conectada previamente');
                    });
            }
        });
    </script>
</body>
</html>