<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlashMorCoin FMC - Conexi√≥n Autom√°tica</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: linear-gradient(135deg, #0f1b3a 0%, #1a2a6c 50%, #2d1b69 100%);
            color: white; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        /* Header */
        header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 20px 40px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .fmc-logo {
            width: 60px;
            height: 60px;
            background: radial-gradient(circle at 30% 30%, #FFD700, #FFA500, #FF8C00);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 20px rgba(255, 165, 0, 0.5);
            border: 2px solid #FFA500;
        }

        .logo-design {
            text-align: center;
            color: #8B4513;
            text-shadow: 1px 1px 2px rgba(255, 215, 0, 0.5);
        }

        .logo-symbol {
            font-size: 20px;
            font-weight: bold;
        }

        .logo-text {
            font-size: 9px;
            font-weight: bold;
            letter-spacing: 1px;
        }
        
        .brand-text {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* Cards */
        .card { 
            background: rgba(255,255,255,0.05); 
            backdrop-filter: blur(15px);
            padding: 30px; 
            border-radius: 20px; 
            margin: 25px 0; 
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .action-btn { 
            background: linear-gradient(45deg, #FF6B35, #F7931E);
            color: white; 
            border: none; 
            padding: 15px 25px; 
            border-radius: 12px; 
            cursor: pointer; 
            margin: 12px 0; 
            font-weight: 600; 
            width: 100%;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(255, 107, 53, 0.4);
        }
        
        .action-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .secondary-btn {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .secondary-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); 
            gap: 25px; 
        }
        
        /* Auto Connect Status */
        .auto-connect-status {
            background: rgba(0, 210, 106, 0.1);
            border: 1px solid rgba(0, 210, 106, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .auto-connect-status.error {
            background: rgba(255, 77, 77, 0.1);
            border: 1px solid rgba(255, 77, 77, 0.3);
        }
        
        .auto-connect-status.warning {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
        }
        
        /* Wallet Detection */
        .wallet-detection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .wallet-detection-item {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .wallet-detected {
            border-color: #00d26a;
            background: rgba(0, 210, 106, 0.1);
        }
        
        .wallet-not-detected {
            border-color: #ff4d4d;
            background: rgba(255, 77, 77, 0.1);
        }
        
        /* Send FMC Section */
        .send-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 768px) {
            .send-container {
                grid-template-columns: 1fr;
            }
        }
        
        .p2p-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .form-control {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 12px 15px;
            color: white;
            font-size: 16px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #FF6B35;
        }
        
        .transaction-details {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .transaction-details h3 {
            margin-bottom: 15px;
            color: #FF6B35;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .detail-row:last-child {
            border-bottom: none;
        }
        
        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .quick-action-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .quick-action-btn:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-3px);
        }
        
        .quick-action-icon {
            font-size: 30px;
            margin-bottom: 10px;
            color: #FF6B35;
        }
        
        /* Top Cryptos */
        .crypto-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .crypto-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .crypto-card:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.08);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .crypto-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .crypto-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .crypto-name {
            font-weight: 600;
            font-size: 18px;
        }
        
        .crypto-symbol {
            color: rgba(255,255,255,0.7);
            font-size: 14px;
        }
        
        .crypto-price {
            font-size: 20px;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .crypto-change {
            font-size: 14px;
            font-weight: 600;
        }
        
        .positive {
            color: #00d26a;
        }
        
        .negative {
            color: #ff4d4d;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #0f1b3a 0%, #1a2a6c 100%);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #FF6B35;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .success-animation {
            text-align: center;
            margin: 20px 0;
        }
        
        .checkmark {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: block;
            stroke-width: 2;
            stroke: #00d26a;
            stroke-miterlimit: 10;
            margin: 0 auto;
            box-shadow: inset 0px 0px 0px #00d26a;
            animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
        }
        
        .checkmark__circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 2;
            stroke-miterlimit: 10;
            stroke: #00d26a;
            fill: none;
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }
        
        .checkmark__check {
            transform-origin: 50% 50%;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        }
        
        @keyframes stroke {
            100% {
                stroke-dashoffset: 0;
            }
        }
        
        @keyframes scale {
            0%, 100% {
                transform: none;
            }
            50% {
                transform: scale3d(1.1, 1.1, 1);
            }
        }
        
        @keyframes fill {
            100% {
                box-shadow: inset 0px 0px 0px 30px #00d26a;
            }
        }
        
        /* Footer */
        footer {
            text-align: center;
            padding: 30px 0;
            margin-top: 50px;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.6);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .brand-text {
                font-size: 1.8rem;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo-container">
                <div class="fmc-logo">
                    <div class="logo-design">
                        <div class="logo-symbol">‚ö°</div>
                        <div class="logo-text">FMC</div>
                    </div>
                </div>
                <div class="brand-text">FlashMorCoin FMC</div>
            </div>
            
            <div class="wallet-info" id="wallet-info" style="display: none;">
                <div><strong>‚úÖ Conectado:</strong> <span id="wallet-address"></span></div>
                <div><strong>üåê Red:</strong> <span id="network-name">-</span></div>
                <div><strong>üí∞ Balance FMC:</strong> <span id="fmc-balance">0</span></div>
            </div>
            
            <button class="action-btn" id="connect-wallet-btn" style="width: auto; padding: 10px 20px;">
                <i class="fas fa-wallet"></i> Conectando...
            </button>
        </header>

        <!-- Estado de Conexi√≥n Autom√°tica -->
        <div class="card">
            <h1><i class="fas fa-robot"></i> Sistema de Conexi√≥n Autom√°tica</h1>
            <div id="auto-connect-status" class="auto-connect-status">
                <i class="fas fa-sync fa-spin"></i>
                <span>Buscando wallets disponibles...</span>
            </div>
            
            <div class="wallet-detection">
                <div class="wallet-detection-item" id="metamask-status">
                    <i class="fab fa-ethereum"></i>
                    <div>MetaMask</div>
                    <div class="status">Buscando...</div>
                </div>
                <div class="wallet-detection-item" id="trustwallet-status">
                    <i class="fas fa-mobile-alt"></i>
                    <div>Trust Wallet</div>
                    <div class="status">Buscando...</div>
                </div>
                <div class="wallet-detection-item" id="binance-status">
                    <i class="fas fa-wallet"></i>
                    <div>Binance Wallet</div>
                    <div class="status">Buscando...</div>
                </div>
                <div class="wallet-detection-item" id="coinbase-status">
                    <i class="fas fa-coins"></i>
                    <div>Coinbase Wallet</div>
                    <div class="status">Buscando...</div>
                </div>
            </div>
            
            <div id="connection-help" style="display: none; margin-top: 20px; padding: 15px; background: rgba(255,193,7,0.1); border-radius: 10px; border: 1px solid rgba(255,193,7,0.3);">
                <h4><i class="fas fa-question-circle"></i> ¬øNo se detecta tu wallet?</h4>
                <ul style="padding-left: 20px; margin-top: 10px;">
                    <li>Aseg√∫rate de tener instalada una wallet como MetaMask</li>
                    <li>Si usas m√≥vil, abre esta p√°gina desde tu wallet integrada</li>
                    <li>Verifica que tu wallet est√© desbloqueada</li>
                    <li>Prueba a recargar la p√°gina</li>
                </ul>
            </div>
        </div>

        <!-- Acciones R√°pidas -->
        <div class="card">
            <h1><i class="fas fa-bolt"></i> Acciones R√°pidas</h1>
            <p>Gestiona tus FMC de forma r√°pida y sencilla</p>
            
            <div class="quick-actions">
                <div class="quick-action-btn" id="quick-send-btn">
                    <div class="quick-action-icon"><i class="fas fa-paper-plane"></i></div>
                    <div>Enviar FMC</div>
                </div>
                <div class="quick-action-btn" id="quick-receive-btn">
                    <div class="quick-action-icon"><i class="fas fa-qrcode"></i></div>
                    <div>Recibir FMC</div>
                </div>
                <div class="quick-action-btn" id="quick-buy-btn">
                    <div class="quick-action-icon"><i class="fas fa-shopping-cart"></i></div>
                    <div>Comprar FMC</div>
                </div>
                <div class="quick-action-btn" id="quick-swap-btn">
                    <div class="quick-action-icon"><i class="fas fa-exchange-alt"></i></div>
                    <div>Swap FMC</div>
                </div>
            </div>
        </div>

        <!-- Secci√≥n de Env√≠o Directo a Wallet -->
        <div class="card">
            <h1><i class="fas fa-paper-plane"></i> Enviar FMC Directamente a Wallet</h1>
            <p>Env√≠a FlashMorCoin FMC directamente a cualquier direcci√≥n de wallet de forma segura</p>
            
            <div class="send-container">
                <div>
                    <div class="p2p-form">
                        <div class="form-group">
                            <label for="recipient-address">Direcci√≥n del Destinatario</label>
                            <input type="text" id="recipient-address" class="form-control" placeholder="0x..." maxlength="42">
                            <small style="color: rgba(255,255,255,0.7);">Introduce una direcci√≥n de wallet v√°lida (0x...)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="send-amount">Cantidad de FMC a enviar</label>
                            <input type="number" id="send-amount" class="form-control" placeholder="Ej: 100" step="0.001" min="0.001">
                        </div>
                        
                        <div class="form-group">
                            <label for="send-network">Red Blockchain</label>
                            <select id="send-network" class="form-control">
                                <option value="eth">Ethereum (ERC-20)</option>
                                <option value="bsc">Binance Smart Chain (BEP-20)</option>
                                <option value="polygon">Polygon</option>
                                <option value="avalanche">Avalanche</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="send-message">Mensaje (Opcional)</label>
                            <textarea id="send-message" class="form-control" rows="3" placeholder="A√±ade un mensaje a la transacci√≥n..."></textarea>
                        </div>
                        
                        <button class="action-btn" id="send-fmc-btn" disabled>
                            <i class="fas fa-paper-plane"></i> Enviar FMC
                        </button>
                        
                        <button class="action-btn secondary-btn" id="max-amount-btn">
                            <i class="fas fa-coins"></i> Usar Balance M√°ximo
                        </button>
                    </div>
                </div>
                
                <div>
                    <h3>Detalles de la Transacci√≥n</h3>
                    <div class="transaction-details">
                        <div class="detail-row">
                            <span>Destinatario:</span>
                            <span id="detail-recipient">-</span>
                        </div>
                        <div class="detail-row">
                            <span>Cantidad:</span>
                            <span id="detail-amount">- FMC</span>
                        </div>
                        <div class="detail-row">
                            <span>Red:</span>
                            <span id="detail-network">-</span>
                        </div>
                        <div class="detail-row">
                            <span>Tarifa de red (Gas):</span>
                            <span id="detail-gas">-</span>
                        </div>
                        <div class="detail-row">
                            <span>Total a enviar:</span>
                            <span id="detail-total">- FMC</span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                        <h4><i class="fas fa-shield-alt"></i> Seguridad</h4>
                        <ul style="padding-left: 20px; margin-top: 10px;">
                            <li>Verifica siempre la direcci√≥n del destinatario</li>
                            <li>Las transacciones en blockchain son irreversibles</li>
                            <li>Confirma los detalles antes de enviar</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Secci√≥n de Mejores Criptomonedas -->
        <div class="card">
            <h1><i class="fas fa-chart-line"></i> Top Criptomonedas del Mercado</h1>
            <p>Las principales criptomonedas por capitalizaci√≥n de mercado</p>
            
            <div class="crypto-grid">
                <div class="crypto-card">
                    <div class="crypto-header">
                        <div class="crypto-icon" style="background: linear-gradient(45deg, #F7931A, #F2A900);">
                            <i class="fab fa-bitcoin"></i>
                        </div>
                        <div>
                            <div class="crypto-name">Bitcoin</div>
                            <div class="crypto-symbol">BTC</div>
                        </div>
                    </div>
                    <div class="crypto-price">$45,230.15</div>
                    <div class="crypto-change positive">+2.34%</div>
                </div>
                
                <div class="crypto-card">
                    <div class="crypto-header">
                        <div class="crypto-icon" style="background: linear-gradient(45deg, #627EEA, #8A92B2);">
                            <i class="fab fa-ethereum"></i>
                        </div>
                        <div>
                            <div class="crypto-name">Ethereum</div>
                            <div class="crypto-symbol">ETH</div>
                        </div>
                    </div>
                    <div class="crypto-price">$3,210.75</div>
                    <div class="crypto-change positive">+1.78%</div>
                </div>
                
                <div class="crypto-card">
                    <div class="crypto-header">
                        <div class="crypto-icon" style="background: linear-gradient(45deg, #F0B90B, #F8D33A);">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div>
                            <div class="crypto-name">Binance Coin</div>
                            <div class="crypto-symbol">BNB</div>
                        </div>
                    </div>
                    <div class="crypto-price">$520.40</div>
                    <div class="crypto-change negative">-0.45%</div>
                </div>
                
                <div class="crypto-card">
                    <div class="crypto-header">
                        <div class="crypto-icon" style="background: linear-gradient(45deg, #00D395, #00B37D);">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div>
                            <div class="crypto-name">Tether</div>
                            <div class="crypto-symbol">USDT</div>
                        </div>
                    </div>
                    <div class="crypto-price">$1.00</div>
                    <div class="crypto-change positive">+0.01%</div>
                </div>
                
                <div class="crypto-card">
                    <div class="crypto-header">
                        <div class="crypto-icon" style="background: linear-gradient(45deg, #00C4B4, #00A3E0);">
                            <i class="fas fa-water"></i>
                        </div>
                        <div>
                            <div class="crypto-name">Cardano</div>
                            <div class="crypto-symbol">ADA</div>
                        </div>
                    </div>
                    <div class="crypto-price">$1.25</div>
                    <div class="crypto-change positive">+3.12%</div>
                </div>
                
                <div class="crypto-card">
                    <div class="crypto-header">
                        <div class="crypto-icon" style="background: linear-gradient(45deg, #FF6B35, #F7931E);">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <div>
                            <div class="crypto-name">FlashMorCoin</div>
                            <div class="crypto-symbol">FMC</div>
                        </div>
                    </div>
                    <div class="crypto-price">$0.85</div>
                    <div class="crypto-change positive">+15.67%</div>
                </div>
            </div>
        </div>

        <!-- Modal de Confirmaci√≥n de Transacci√≥n -->
        <div class="modal" id="transaction-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="modal-title">Confirmar Transacci√≥n</h3>
                    <button class="close-modal" id="close-modal">&times;</button>
                </div>
                <div id="modal-body">
                    <!-- Contenido din√°mico del modal -->
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer>
            <p>FlashMorCoin FMC - Plataforma con Conexi√≥n Autom√°tica Mejorada</p>
            <p>¬© 2023 Todos los derechos reservados</p>
        </footer>
    </div>

    <script>
        // Variables globales
        let web3;
        let currentAccount;
        let currentNetwork;
        let isAutoConnecting = false;

        // Elementos del DOM
        const connectWalletBtn = document.getElementById('connect-wallet-btn');
        const walletInfo = document.getElementById('wallet-info');
        const walletAddress = document.getElementById('wallet-address');
        const networkName = document.getElementById('network-name');
        const fmcBalance = document.getElementById('fmc-balance');
        const autoConnectStatus = document.getElementById('auto-connect-status');
        const connectionHelp = document.getElementById('connection-help');
        
        // Elementos de detecci√≥n de wallets
        const metamaskStatus = document.getElementById('metamask-status');
        const trustwalletStatus = document.getElementById('trustwallet-status');
        const binanceStatus = document.getElementById('binance-status');
        const coinbaseStatus = document.getElementById('coinbase-status');
        
        // Elementos de env√≠o
        const recipientAddress = document.getElementById('recipient-address');
        const sendAmount = document.getElementById('send-amount');
        const sendNetwork = document.getElementById('send-network');
        const sendMessage = document.getElementById('send-message');
        const sendFmcBtn = document.getElementById('send-fmc-btn');
        const maxAmountBtn = document.getElementById('max-amount-btn');
        
        // Elementos de detalles
        const detailRecipient = document.getElementById('detail-recipient');
        const detailAmount = document.getElementById('detail-amount');
        const detailNetwork = document.getElementById('detail-network');
        const detailGas = document.getElementById('detail-gas');
        const detailTotal = document.getElementById('detail-total');
        
        // Botones de acci√≥n r√°pida
        const quickSendBtn = document.getElementById('quick-send-btn');
        const quickReceiveBtn = document.getElementById('quick-receive-btn');
        const quickBuyBtn = document.getElementById('quick-buy-btn');
        const quickSwapBtn = document.getElementById('quick-swap-btn');
        
        // Modal
        const transactionModal = document.getElementById('transaction-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');
        const closeModal = document.getElementById('close-modal');
        
        // Inicializaci√≥n autom√°tica
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar todas las funcionalidades
            setupSendValidation();
            setupQuickActions();
            setupModal();
            
            // Iniciar detecci√≥n de wallets
            startWalletDetection();
            
            // Iniciar conexi√≥n autom√°tica
            startAutoConnect();
        });
        
        // Detecci√≥n de wallets disponibles
        function startWalletDetection() {
            updateAutoConnectStatus('üîç Detectando wallets disponibles...', 'loading');
            
            // Verificar MetaMask
            setTimeout(() => {
                if (typeof window.ethereum !== 'undefined') {
                    updateWalletStatus(metamaskStatus, '‚úÖ Detectado', 'detected');
                } else {
                    updateWalletStatus(metamaskStatus, '‚ùå No detectado', 'not-detected');
                }
            }, 1000);
            
            // Verificar Trust Wallet (tambi√©n usa window.ethereum)
            setTimeout(() => {
                if (typeof window.ethereum !== 'undefined') {
                    // Trust Wallet tambi√©n se detecta como ethereum
                    updateWalletStatus(trustwalletStatus, '‚úÖ Posible', 'detected');
                } else {
                    updateWalletStatus(trustwalletStatus, '‚ùå No detectado', 'not-detected');
                }
            }, 1500);
            
            // Verificar Binance Chain Wallet
            setTimeout(() => {
                if (typeof window.BinanceChain !== 'undefined') {
                    updateWalletStatus(binanceStatus, '‚úÖ Detectado', 'detected');
                } else {
                    updateWalletStatus(binanceStatus, '‚ùå No detectado', 'not-detected');
                }
            }, 2000);
            
            // Verificar Coinbase Wallet
            setTimeout(() => {
                if (typeof window.ethereum !== 'undefined' && window.ethereum.isCoinbaseWallet) {
                    updateWalletStatus(coinbaseStatus, '‚úÖ Detectado', 'detected');
                } else if (typeof window.ethereum !== 'undefined') {
                    updateWalletStatus(coinbaseStatus, '‚ö†Ô∏è Posible', 'detected');
                } else {
                    updateWalletStatus(coinbaseStatus, '‚ùå No detectado', 'not-detected');
                }
            }, 2500);
            
            // Mostrar ayuda despu√©s de la detecci√≥n
            setTimeout(() => {
                if (typeof window.ethereum === 'undefined' && typeof window.BinanceChain === 'undefined') {
                    connectionHelp.style.display = 'block';
                    updateAutoConnectStatus('‚ùå No se detectaron wallets', 'error');
                } else {
                    updateAutoConnectStatus('‚úÖ Wallets detectadas. Conectando...', 'success');
                }
            }, 3000);
        }
        
        // Actualizar estado de wallet individual
        function updateWalletStatus(element, status, type) {
            const statusElement = element.querySelector('.status');
            statusElement.textContent = status;
            
            element.classList.remove('wallet-detected', 'wallet-not-detected');
            if (type === 'detected') {
                element.classList.add('wallet-detected');
            } else {
                element.classList.add('wallet-not-detected');
            }
        }
        
        // Conexi√≥n autom√°tica a wallet
        async function startAutoConnect() {
            if (isAutoConnecting) return;
            
            isAutoConnecting = true;
            connectWalletBtn.disabled = true;
            
            try {
                await autoConnectToWallet();
            } catch (error) {
                console.error('Error en conexi√≥n autom√°tica:', error);
                handleConnectionError(error);
            } finally {
                isAutoConnecting = false;
                connectWalletBtn.disabled = false;
            }
        }
        
        // Conexi√≥n autom√°tica
        async function autoConnectToWallet() {
            // Primero intentar con Ethereum (MetaMask, Trust Wallet, etc.)
            if (typeof window.ethereum !== 'undefined') {
                updateAutoConnectStatus('üîÑ Conectando con Ethereum...', 'loading');
                
                try {
                    web3 = new Web3(window.ethereum);
                    
                    // Verificar si ya estamos conectados
                    const accounts = await window.ethereum.request({ 
                        method: 'eth_accounts' 
                    });
                    
                    if (accounts.length > 0) {
                        // Ya conectado
                        currentAccount = accounts[0];
                        const chainId = await web3.eth.getChainId();
                        updateNetworkInfo(chainId);
                        updateWalletInfo();
                        updateAutoConnectStatus('‚úÖ Conectado autom√°ticamente', 'success');
                        setupWalletListeners();
                        return;
                    }
                    
                    // Intentar conexi√≥n autom√°tica
                    updateAutoConnectStatus('üîê Solicitando acceso...', 'loading');
                    const newAccounts = await window.ethereum.request({ 
                        method: 'eth_requestAccounts' 
                    });
                    
                    if (newAccounts.length > 0) {
                        currentAccount = newAccounts[0];
                        const chainId = await web3.eth.getChainId();
                        updateNetworkInfo(chainId);
                        updateWalletInfo();
                        updateAutoConnectStatus('‚úÖ Conexi√≥n autom√°tica exitosa', 'success');
                        setupWalletListeners();
                    } else {
                        throw new Error('Usuario rechaz√≥ la conexi√≥n');
                    }
                    
                } catch (error) {
                    if (error.code === 4001) {
                        // Usuario rechaz√≥ la conexi√≥n
                        updateAutoConnectStatus('‚è∏Ô∏è Conexi√≥n rechazada. Usa el bot√≥n para conectar.', 'warning');
                        connectWalletBtn.textContent = 'Conectar Wallet';
                        connectWalletBtn.onclick = manualConnect;
                    } else {
                        throw error;
                    }
                }
                
            } 
            // Intentar con Binance Chain Wallet
            else if (typeof window.BinanceChain !== 'undefined') {
                updateAutoConnectStatus('üîÑ Conectando con Binance Chain...', 'loading');
                
                try {
                    web3 = new Web3(window.BinanceChain);
                    const accounts = await window.BinanceChain.request({ 
                        method: 'eth_accounts' 
                    });
                    
                    if (accounts.length > 0) {
                        currentAccount = accounts[0];
                        const chainId = await web3.eth.getChainId();
                        updateNetworkInfo(chainId);
                        updateWalletInfo();
                        updateAutoConnectStatus('‚úÖ Conectado con Binance Chain', 'success');
                    }
                } catch (error) {
                    console.error('Error con Binance Chain:', error);
                    throw error;
                }
                
            } else {
                // No hay wallet detectada
                updateAutoConnectStatus('‚ùå No se detect√≥ wallet compatible', 'error');
                connectWalletBtn.textContent = 'Instalar Wallet';
                connectWalletBtn.onclick = installWallet;
            }
        }
        
        // Conexi√≥n manual
        async function manualConnect() {
            updateAutoConnectStatus('üîÑ Conectando manualmente...', 'loading');
            await startAutoConnect();
        }
        
        // Manejar errores de conexi√≥n
        function handleConnectionError(error) {
            console.error('Error de conexi√≥n:', error);
            
            if (error.code === 4001) {
                updateAutoConnectStatus('‚è∏Ô∏è Conexi√≥n rechazada por el usuario', 'warning');
            } else if (error.message.includes('No wallet detected')) {
                updateAutoConnectStatus('‚ùå No se detect√≥ wallet compatible', 'error');
                connectWalletBtn.textContent = 'Instalar Wallet';
                connectWalletBtn.onclick = installWallet;
            } else {
                updateAutoConnectStatus('‚ùå Error de conexi√≥n: ' + error.message, 'error');
            }
            
            connectWalletBtn.textContent = 'Reintentar Conexi√≥n';
            connectWalletBtn.onclick = manualConnect;
        }
        
        // Configurar listeners de wallet
        function setupWalletListeners() {
            if (window.ethereum) {
                window.ethereum.on('accountsChanged', (accounts) => {
                    if (accounts.length === 0) {
                        resetWalletInfo();
                        updateAutoConnectStatus('üîå Wallet desconectada', 'warning');
                    } else {
                        currentAccount = accounts[0];
                        updateWalletInfo();
                        updateAutoConnectStatus('‚úÖ Cuenta actualizada', 'success');
                    }
                });
                
                window.ethereum.on('chainChanged', (chainId) => {
                    updateNetworkInfo(parseInt(chainId, 16));
                    updateAutoConnectStatus('‚úÖ Red cambiada', 'success');
                });
            }
        }
        
        // Actualizar estado de conexi√≥n autom√°tica
        function updateAutoConnectStatus(message, type) {
            const icon = autoConnectStatus.querySelector('i');
            autoConnectStatus.querySelector('span').textContent = message;
            
            autoConnectStatus.className = 'auto-connect-status';
            
            switch(type) {
                case 'loading':
                    icon.className = 'fas fa-sync fa-spin';
                    break;
                case 'success':
                    icon.className = 'fas fa-check-circle';
                    autoConnectStatus.style.background = 'rgba(0, 210, 106, 0.1)';
                    autoConnectStatus.style.border = '1px solid rgba(0, 210, 106, 0.3)';
                    break;
                case 'warning':
                    icon.className = 'fas fa-exclamation-triangle';
                    autoConnectStatus.className += ' warning';
                    break;
                case 'error':
                    icon.className = 'fas fa-times-circle';
                    autoConnectStatus.className += ' error';
                    break;
            }
        }
        
        // Instalar wallet
        function installWallet() {
            window.open('https://metamask.io/download.html', '_blank');
        }
        
        // Configuraci√≥n de validaci√≥n de env√≠o
        function setupSendValidation() {
            recipientAddress.addEventListener('input', validateSendForm);
            sendAmount.addEventListener('input', validateSendForm);
            
            recipientAddress.addEventListener('input', updateTransactionDetails);
            sendAmount.addEventListener('input', updateTransactionDetails);
            sendNetwork.addEventListener('change', updateTransactionDetails);
            
            sendFmcBtn.addEventListener('click', sendFMC);
            maxAmountBtn.addEventListener('click', setMaxAmount);
        }
        
        // Configuraci√≥n de acciones r√°pidas
        function setupQuickActions() {
            quickSendBtn.addEventListener('click', () => {
                if (!currentAccount) {
                    showError('Conecta tu wallet primero');
                    return;
                }
                document.querySelector('.send-container').scrollIntoView({ 
                    behavior: 'smooth' 
                });
            });
            
            quickReceiveBtn.addEventListener('click', () => {
                if (!currentAccount) {
                    showError('Conecta tu wallet primero');
                    return;
                }
                showReceiveModal();
            });
            
            quickBuyBtn.addEventListener('click', () => {
                if (!currentAccount) {
                    showError('Conecta tu wallet primero');
                    return;
                }
                showBuyOptions();
            });
            
            quickSwapBtn.addEventListener('click', () => {
                if (!currentAccount) {
                    showError('Conecta tu wallet primero');
                    return;
                }
                showSwapOptions();
            });
        }
        
        // Configuraci√≥n del modal
        function setupModal() {
            closeModal.addEventListener('click', () => {
                transactionModal.style.display = 'none';
            });
            
            window.addEventListener('click', (e) => {
                if (e.target === transactionModal) {
                    transactionModal.style.display = 'none';
                }
            });
        }
        
        // Validar formulario de env√≠o
        function validateSendForm() {
            const address = recipientAddress.value.trim();
            const amount = parseFloat(sendAmount.value);
            
            const isValidAddress = /^0x[a-fA-F0-9]{40}$/.test(address);
            const isValidAmount = !isNaN(amount) && amount > 0;
            
            sendFmcBtn.disabled = !(isValidAddress && isValidAmount);
            
            return isValidAddress && isValidAmount;
        }
        
        // Actualizar detalles de transacci√≥n
        function updateTransactionDetails() {
            const address = recipientAddress.value.trim();
            const amount = parseFloat(sendAmount.value);
            const network = sendNetwork.options[sendNetwork.selectedIndex].text;
            
            if (address && /^0x[a-fA-F0-9]{40}$/.test(address)) {
                detailRecipient.textContent = `${address.substring(0, 6)}...${address.substring(address.length - 4)}`;
            } else {
                detailRecipient.textContent = '-';
            }
            
            if (!isNaN(amount) && amount > 0) {
                detailAmount.textContent = `${amount} FMC`;
                const gasFee = calculateGasFee(amount, network);
                detailGas.textContent = `${gasFee} ETH`;
                detailTotal.textContent = `${amount} FMC + ${gasFee} ETH`;
            } else {
                detailAmount.textContent = '- FMC';
                detailGas.textContent = '-';
                detailTotal.textContent = '- FMC';
            }
            
            detailNetwork.textContent = network;
        }
        
        // Calcular tarifa de gas (simulaci√≥n)
        function calculateGasFee(amount, network) {
            const baseFees = {
                'Ethereum (ERC-20)': 0.0025,
                'Binance Smart Chain (BEP-20)': 0.0005,
                'Polygon': 0.0001,
                'Avalanche': 0.0003
            };
            
            const baseFee = baseFees[network] || 0.001;
            const amountFactor = Math.min(amount / 1000, 1);
            const finalFee = baseFee * (1 + amountFactor);
            
            return finalFee.toFixed(6);
        }
        
        // Establecer cantidad m√°xima
        function setMaxAmount() {
            if (currentAccount) {
                const maxBalance = 1250.75;
                const gasFee = 0.001;
                const maxSendable = maxBalance - gasFee;
                
                sendAmount.value = maxSendable.toFixed(3);
                updateTransactionDetails();
                validateSendForm();
            } else {
                showError('Conecta tu wallet primero para usar esta funci√≥n');
            }
        }
        
        // Enviar FMC
        async function sendFMC() {
            if (!validateSendForm()) {
                showError('Por favor, completa correctamente todos los campos');
                return;
            }
            
            if (!currentAccount) {
                showError('Debes conectar tu wallet primero');
                return;
            }
            
            const recipient = recipientAddress.value.trim();
            const amount = parseFloat(sendAmount.value);
            const network = sendNetwork.value;
            const message = sendMessage.value.trim();
            
            try {
                showConfirmationModal(recipient, amount, network, message);
            } catch (error) {
                console.error('Error preparando transacci√≥n:', error);
                showError('Error al preparar la transacci√≥n: ' + error.message);
            }
        }
        
        // Mostrar modal de confirmaci√≥n
        function showConfirmationModal(recipient, amount, network, message) {
            modalTitle.textContent = 'Confirmar Env√≠o de FMC';
            
            const gasFee = calculateGasFee(amount, sendNetwork.options[sendNetwork.selectedIndex].text);
            
            modalBody.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <p>¬øEst√°s seguro de que quieres enviar <strong>${amount} FMC</strong> a la siguiente direcci√≥n?</p>
                    <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; margin: 10px 0; word-break: break-all;">
                        ${recipient}
                    </div>
                    <div class="detail-row">
                        <span>Red:</span>
                        <span>${sendNetwork.options[sendNetwork.selectedIndex].text}</span>
                    </div>
                    <div class="detail-row">
                        <span>Tarifa estimada:</span>
                        <span>${gasFee} ETH</span>
                    </div>
                    ${message ? `
                    <div class="detail-row">
                        <span>Mensaje:</span>
                        <span>${message}</span>
                    </div>
                    ` : ''}
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="action-btn" id="confirm-send" style="flex: 1;">
                        <i class="fas fa-check"></i> Confirmar Env√≠o
                    </button>
                    <button class="action-btn secondary-btn" id="cancel-send" style="flex: 1;">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            `;
            
            transactionModal.style.display = 'flex';
            
            document.getElementById('confirm-send').addEventListener('click', () => {
                executeTransaction(recipient, amount, network, message);
            });
            
            document.getElementById('cancel-send').addEventListener('click', () => {
                transactionModal.style.display = 'none';
            });
        }
        
        // Ejecutar transacci√≥n
        async function executeTransaction(recipient, amount, network, message) {
            try {
                modalBody.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 3rem; margin-bottom: 20px;">
                            <i class="fas fa-spinner fa-spin"></i>
                        </div>
                        <h3>Procesando Transacci√≥n</h3>
                        <p>Por favor, confirma la transacci√≥n en tu wallet...</p>
                    </div>
                `;
                
                setTimeout(() => {
                    showTransactionSuccess(recipient, amount, network);
                }, 3000);
                
            } catch (error) {
                console.error('Error ejecutando transacci√≥n:', error);
                showError('Error al ejecutar la transacci√≥n: ' + error.message);
                transactionModal.style.display = 'none';
            }
        }
        
        // Mostrar √©xito de transacci√≥n
        function showTransactionSuccess(recipient, amount, network) {
            modalBody.innerHTML = `
                <div class="success-animation">
                    <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                        <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
                        <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                    </svg>
                    <h3>¬°Transacci√≥n Exitosa!</h3>
                    <p>Has enviado <strong>${amount} FMC</strong> correctamente.</p>
                    <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; margin: 15px 0;">
                        <div><strong>Destinatario:</strong> ${recipient.substring(0, 6)}...${recipient.substring(recipient.length - 4)}</div>
                        <div><strong>Red:</strong> ${sendNetwork.options[sendNetwork.selectedIndex].text}</div>
                        <div><strong>ID de Transacci√≥n:</strong> 0x${Math.random().toString(16).substring(2, 10)}...</div>
                    </div>
                    <button class="action-btn" id="close-success">
                        <i class="fas fa-check"></i> Aceptar
                    </button>
                </div>
            `;
            
            document.getElementById('close-success').addEventListener('click', () => {
                transactionModal.style.display = 'none';
                recipientAddress.value = '';
                sendAmount.value = '';
                sendMessage.value = '';
                updateTransactionDetails();
            });
        }
        
        // Mostrar modal de recibir
        function showReceiveModal() {
            modalTitle.textContent = 'Recibir FMC';
            
            modalBody.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div style="background: white; padding: 20px; border-radius: 10px; display: inline-block; margin-bottom: 20px;">
                        <div id="qr-code" style="width: 200px; height: 200px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; color: #333;">
                            <i class="fas fa-qrcode" style="font-size: 80px;"></i>
                        </div>
                    </div>
                    <h3>Tu Direcci√≥n FMC</h3>
                    <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; margin: 15px 0; word-break: break-all;">
                        ${currentAccount}
                    </div>
                    <p>Comparte esta direcci√≥n o escanea el c√≥digo QR para recibir FMC</p>
                    <button class="action-btn secondary-btn" id="copy-address">
                        <i class="fas fa-copy"></i> Copiar Direcci√≥n
                    </button>
                </div>
            `;
            
            transactionModal.style.display = 'flex';
            
            document.getElementById('copy-address').addEventListener('click', () => {
                navigator.clipboard.writeText(currentAccount);
                alert('Direcci√≥n copiada al portapapeles');
            });
        }
        
        // Mostrar opciones de compra
        function showBuyOptions() {
            modalTitle.textContent = 'Comprar FMC';
            
            modalBody.innerHTML = `
                <div style="text-align: center;">
                    <h3>M√©todos de Compra</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
                        <div class="quick-action-btn">
                            <div class="quick-action-icon"><i class="fas fa-credit-card"></i></div>
                            <div>Tarjeta</div>
                        </div>
                        <div class="quick-action-btn">
                            <div class="quick-action-icon"><i class="fas fa-university"></i></div>
                            <div>Transferencia</div>
                        </div>
                        <div class="quick-action-btn">
                            <div class="quick-action-icon"><i class="fab fa-paypal"></i></div>
                            <div>PayPal</div>
                        </div>
                        <div class="quick-action-btn">
                            <div class="quick-action-icon"><i class="fas fa-exchange-alt"></i></div>
                            <div>Swap</div>
                        </div>
                    </div>
                    <p>Selecciona tu m√©todo de pago preferido para comprar FMC</p>
                </div>
            `;
            
            transactionModal.style.display = 'flex';
        }
        
        // Mostrar opciones de swap
        function showSwapOptions() {
            modalTitle.textContent = 'Swap FMC';
            
            modalBody.innerHTML = `
                <div>
                    <h3>Intercambiar Criptomonedas</h3>
                    <div class="p2p-form">
                        <div class="form-group">
                            <label>Desde</label>
                            <select class="form-control">
                                <option>ETH</option>
                                <option>USDT</option>
                                <option>BNB</option>
                                <option>USDC</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Cantidad</label>
                            <input type="number" class="form-control" placeholder="0.0">
                        </div>
                        <div class="form-group">
                            <label>Hacia</label>
                            <select class="form-control">
                                <option selected>FMC</option>
                                <option>ETH</option>
                                <option>USDT</option>
                                <option>BNB</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Recibir√°s aproximadamente</label>
                            <input type="text" class="form-control" value="0 FMC" readonly>
                        </div>
                        <button class="action-btn">
                            <i class="fas fa-exchange-alt"></i> Realizar Swap
                        </button>
                    </div>
                </div>
            `;
            
            transactionModal.style.display = 'flex';
        }
        
        // Mostrar error
        function showError(message) {
            modalTitle.textContent = 'Error';
            modalBody.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 3rem; margin-bottom: 20px; color: #ff4d4d;">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <h3>Error en la Transacci√≥n</h3>
                    <p>${message}</p>
                    <button class="action-btn" id="close-error" style="margin-top: 20px;">
                        <i class="fas fa-times"></i> Cerrar
                    </button>
                </div>
            `;
            
            transactionModal.style.display = 'flex';
            
            document.getElementById('close-error').addEventListener('click', () => {
                transactionModal.style.display = 'none';
            });
        }
        
        // Actualizar informaci√≥n de la red
        function updateNetworkInfo(chainId) {
            const networks = {
                1: 'Ethereum Mainnet',
                3: 'Ropsten Testnet',
                4: 'Rinkeby Testnet',
                5: 'Goerli Testnet',
                42: 'Kovan Testnet',
                56: 'Binance Smart Chain',
                97: 'BSC Testnet',
                137: 'Polygon Mainnet',
                80001: 'Polygon Mumbai Testnet',
                43114: 'Avalanche Mainnet',
                43113: 'Avalanche Fuji Testnet'
            };
            
            currentNetwork = networks[chainId] || `Red desconocida (ID: ${chainId})`;
            networkName.textContent = currentNetwork;
        }
        
        // Actualizar informaci√≥n de la wallet
        function updateWalletInfo() {
            if (currentAccount) {
                const formattedAddress = `${currentAccount.substring(0, 6)}...${currentAccount.substring(currentAccount.length - 4)}`;
                walletAddress.textContent = formattedAddress;
                
                walletInfo.style.display = 'block';
                connectWalletBtn.textContent = 'Desconectar';
                connectWalletBtn.onclick = disconnectWallet;
                
                fmcBalance.textContent = '1,250.75 FMC';
            }
        }
        
        // Reiniciar informaci√≥n de la wallet
        function resetWalletInfo() {
            walletInfo.style.display = 'none';
            connectWalletBtn.textContent = 'Conectar Wallet';
            connectWalletBtn.onclick = manualConnect;
            
            currentAccount = null;
            web3 = null;
        }
        
        // Desconectar wallet
        function disconnectWallet() {
            if (window.ethereum && window.ethereum.disconnect) {
                window.ethereum.disconnect();
            }
            resetWalletInfo();
            updateAutoConnectStatus('Wallet desconectada', 'warning');
        }
    </script>
</body>
</html>